<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1a2a6c">

<meta charset="UTF-8">
<title>Ø±ÙˆØ²Ø´Ù…Ø§Ø± Ø®Ø¯Ù…Øª Ø³Ø±Ø¨Ø§Ø²ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/jalaali-js@1.2.6/dist/jalaali.min.js"></script>
<style>
body{
    font-family:tahoma;
    background:linear-gradient(135deg,#1a2a6c,#b21f1f);
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    color:#333;
    margin:0;
}
.box{
    background:#fff;
    padding:30px;
    border-radius:16px;
    width:100%;
    max-width:480px;
    box-shadow:0 20px 40px rgba(0,0,0,.3);
}
h2{
    color:#1a2a6c;
    margin-bottom:12px;
    text-align:center;
}
.today{
    text-align:center;
    margin-bottom:20px;
    font-weight:bold;
    color:#555;
}
label{
    display:block;
    margin-top:15px;
    font-weight:bold;
}
select,input,button{
    width:100%;
    padding:10px;
    margin-top:6px;
    border-radius:8px;
    border:1px solid #ccc;
    font-size:15px;
}
select{ direction:ltr; }
button{
    margin-top:22px;
    background:#1a2a6c;
    color:#fff;
    border:none;
    cursor:pointer;
    font-weight:bold;
    transition:0.3s;
}
button:hover{
    background:#fdbb2d;
    color:#1a2a6c;
}
.result{
    margin-top:25px;
    background:#f3f5fb;
    padding:18px;
    border-radius:12px;
    display:none;
}
.result div{margin-bottom:10px;font-size:15px;}
.highlight{font-weight:bold;color:#b21f1f;}
.progress-box{
    margin-top:10px;
    background:#e9ecef;
    border-radius:25px;
    overflow:hidden;
}
.progress-bar{
    height:20px;
    width:0%;
    transition:width 0.8s, background 0.8s;
}
.footer{
    text-align:center;
    margin-top:15px;
    font-size:13px;
    color:#777;
}
</style>
</head>
<body>
<div class="box">
<h2>Ø±ÙˆØ²Ø´Ù…Ø§Ø± Ø®Ø¯Ù…Øª Ø³Ø±Ø¨Ø§Ø²ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡</h2>
<div class="today" id="todayDate"></div>

<label>ØªØ§Ø±ÛŒØ® Ø§Ø¹Ø²Ø§Ù… (Ø´Ù…Ø³ÛŒ)</label>
<div style="display:flex; gap:5px;">
    <select id="year"></select>
    <select id="month"></select>
    <select id="day"></select>
</div>

<label>Ù…Ø¯Øª Ø®Ø¯Ù…Øª</label>
<select id="months">
<option value="21">21 Ù…Ø§Ù‡</option>
<option value="24">24 Ù…Ø§Ù‡</option>
</select>

<label>Ø§Ø¶Ø§ÙÙ‡ Ø®Ø¯Ù…Øª (Ø±ÙˆØ²)</label>
<input type="number" id="penalty" value="0">

<label>Ú©Ø³Ø±ÛŒ / Ù…Ø±Ø®ØµÛŒ (Ø±ÙˆØ²)</label>
<input type="number" id="reduction" value="0">

<button onclick="calculate()">Ù…Ø­Ø§Ø³Ø¨Ù‡</button>

<div class="result" id="result">
<div>ğŸ“… ØªØ§Ø±ÛŒØ® Ù¾Ø§ÛŒØ§Ù† Ø®Ø¯Ù…Øª: <span class="highlight" id="endDate"></span></div>
<div>â³ Ø±ÙˆØ²Ù‡Ø§ÛŒ Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: <span class="highlight" id="daysLeft"></span></div>
<div>ğŸ“Š Ø¯Ø±ØµØ¯ Ù¾ÛŒØ´Ø±ÙØª Ø®Ø¯Ù…Øª: <span class="highlight" id="progressText"></span></div>
<div class="progress-box">
    <div class="progress-bar" id="progressBar"></div>
</div>
</div>

<div class="footer">Ø¨Ø§ â¤ï¸ Ø¨Ø±Ø§ÛŒ Ø³Ø±Ø¨Ø§Ø²Ù‡Ø§</div>
</div>

<script>
(function showToday(){
    const now = new Date();
    const j = jalaali.toJalaali(now.getFullYear(), now.getMonth()+1, now.getDate());
    document.getElementById("todayDate").textContent =
        `Ø§Ù…Ø±ÙˆØ²: ${j.jy}-${String(j.jm).padStart(2,"0")}-${String(j.jd).padStart(2,"0")}`;
})();

(function fillDateSelectors(){
    const yearSelect = document.getElementById("year");
    const monthSelect = document.getElementById("month");
    const daySelect = document.getElementById("day");
    const now = new Date();
    const jNow = jalaali.toJalaali(now.getFullYear(), now.getMonth()+1, now.getDate());

    for(let y=1400; y<=1420; y++) yearSelect.add(new Option(y, y));
    for(let m=1; m<=12; m++) monthSelect.add(new Option(m, m));
    for(let d=1; d<=31; d++) daySelect.add(new Option(d, d));

    yearSelect.value = jNow.jy;
    monthSelect.value = jNow.jm;
    daySelect.value = jNow.jd;
})();

function calculate(){
    const jy = parseInt(document.getElementById("year").value);
    const jm = parseInt(document.getElementById("month").value);
    const jd = parseInt(document.getElementById("day").value);

    const months = parseInt(document.getElementById("months").value);
    const penalty = parseInt(document.getElementById("penalty").value);
    const reduction = parseInt(document.getElementById("reduction").value);

    const gStart = jalaali.toGregorian(jy,jm,jd);
    let startDate = new Date(gStart.gy, gStart.gm-1, gStart.gd);
    startDate.setHours(0,0,0,0);

    let endDate = new Date(startDate);
    endDate.setMonth(endDate.getMonth() + months);
    endDate.setDate(endDate.getDate() + penalty - reduction);
    endDate.setHours(0,0,0,0);

    const today = new Date();
    today.setHours(0,0,0,0);

    const totalDays = Math.round((endDate - startDate) / (1000*60*60*24));
    let passedDays = Math.round((today - startDate) / (1000*60*60*24));
    if(passedDays < 0) passedDays = 0;
    if(passedDays > totalDays) passedDays = totalDays;

    const daysLeft = totalDays - passedDays;
    let progress = Math.round((passedDays / totalDays) * 100);

    let color = "#ff4d4d";
    if(progress >= 75) color = "#28a745";
    else if(progress >= 25) color = "#ffc107";

    const jEnd = jalaali.toJalaali(endDate.getFullYear(), endDate.getMonth()+1, endDate.getDate());
    const endStr = `${jEnd.jy}-${String(jEnd.jm).padStart(2,"0")}-${String(jEnd.jd).padStart(2,"0")}`;

    document.getElementById("endDate").textContent = endStr;

    if(daysLeft === 0){
        document.getElementById("daysLeft").textContent = "Ù¾Ø§ÛŒØ§Ù† ÛŒØ§ÙØªÙ‡ ğŸ‰";
        progress = 100;
    } else {
        document.getElementById("daysLeft").textContent = daysLeft + " Ø±ÙˆØ²";
    }

    document.getElementById("progressText").textContent = progress + "Ùª";
    const bar = document.getElementById("progressBar");
    bar.style.width = progress + "%";
    bar.style.background = color;

    document.getElementById("result").style.display="block";
}
</script>
</body>
</html>
